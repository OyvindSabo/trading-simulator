<style>
  #sideBarContent {
    font-family: Arial Black;
    color: darkslategray;
    font-size: 24px;
    margin: 10px;
  }
  .amountInput {
    padding: 10px;
    background-color: whitesmoke;
  }
  .sideBarButton {
    font-family: Arial Black;
    font-size: 24px;
  }
</style>
<script>
  let GRAPH_PERIOD = 1920;
  let GRAPH_HEIGHT = 540;
  let CURRENT_STOCK_PRICE = 500;
  let CURRENT_TIME = 0;
  let CURRENT_MONEY_BALANCE = 1000;
  let CURRENT_STOCK_COUNT = 0;
  let ORDER_TYPE = 'buy';
  let ORDERS = [];
  let PRICE_HISTORY = [];
  
  const handleBuyClick = () => {
    ORDER_TYPE = 'buy';
    document.getElementById('buyButton').style['background-color'] = 'lightgreen';
    document.getElementById('sellButton').style['background-color'] = 'white';
    document.getElementById('placeOrderButton').style['background-color'] = 'lightGreen';
    document.getElementById('placeOrderButton').innerHTML = 'Place buy order';
  }

  const handleSellClick = () => {
    ORDER_TYPE = 'sell';
    document.getElementById('buyButton').style['background-color'] = 'white';
    document.getElementById('sellButton').style['background-color'] = 'orangered';
    document.getElementById('placeOrderButton').style['background-color'] = 'orangered';
    document.getElementById('placeOrderButton').innerHTML = 'Place sell order';
  }

  const handlePlaceOrder = () => {
    const stockCount = parseInt(document.getElementById('stockCountInput').value);
    document.getElementById('stockCountInput').value = '';
    const limitPrice = parseInt(document.getElementById('limitPriceInput').value);
    document.getElementById('limitPriceInput').value = '';
    ORDERS.push({orderType: ORDER_TYPE, stockCount: stockCount, limitPrice: limitPrice});
  }
</script>
<body>
  <div id='tradingWindow' style='width:100%;'>
    <div id='sideBar' style='width:25%;float:left'>
      <div id='sideBarContent'>
        Current price: <span id='currentStockPrice'></span><br>
        <br>
        Money:      €<span id='currentMoneyBalance'></span><br>
        <br>
        Stocks:      <span id='currentStockCount'></span> (€<span id='currentPortfolioValue'></span>)<br>
        <br>
        Total value: €<span id='currentTotalValue'></span><br>
        <br>
        <button id='buyButton' onclick='handleBuyClick()' style='background-color:lightgreen;' class='sideBarButton' type='button' style='width=100%;'>Buy</button>
        <button id='sellButton' onclick='handleSellClick()' style='background-color:white;' class='sideBarButton' type='button' style='width=100%;'>Sell</button><br>
        <br>
        Amount<br>
        <input id='stockCountInput' type='number' min='0' class='amountInput'><br>
        <br>
        Limit price<br>
        <input id='limitPriceInput' type='number' min='0' class='amountInput'><br>
        <br>
        <button id='placeOrderButton' onclick='handlePlaceOrder()' style='background-color:lightgreen;' class='sideBarButton' type='button' style='width=100%;'>Place Buy Order</button>
      </div>
    </div>
    <canvas id='graph' width='1920' height='540';' style='width:75%;float:right'></canvas>
  </div>
</body>

<script>  
  const initCanvas = () => {
    const canvas = document.getElementById('graph');
    const context = canvas.getContext('2d');
    context.fillStyle = 'whitesmoke';
    context.fillRect(0, 0, GRAPH_PERIOD, GRAPH_HEIGHT);
  }

  const addToPriceHistory = () => {
    PRICE_HISTORY.push(CURRENT_STOCK_PRICE);
    while (PRICE_HISTORY.length > GRAPH_PERIOD/10) {
      PRICE_HISTORY.shift();
    }
  }
  
  const handleOrders = () => {
    ORDERS.forEach(order => {
      if (order.orderType === 'buy') {
        if (CURRENT_STOCK_PRICE <= order.limitPrice) {
          CURRENT_MONEY_BALANCE -= CURRENT_STOCK_PRICE*order.stockCount;
          CURRENT_STOCK_COUNT += order.stockCount;
          ORDERS.splice(ORDERS.indexOf(order), 1);
        }
        return;
      }
      if (CURRENT_STOCK_PRICE >= order.limitPrice) {
        CURRENT_MONEY_BALANCE += CURRENT_STOCK_PRICE*order.stockCount;
        CURRENT_STOCK_COUNT -= order.stockCount;
        ORDERS.splice(ORDERS.indexOf(order), 1);
      }
    });
  }

  const average = (list) => list.reduce((a, b) => a+b)/list.length;

  const drawGraph = () => {
    const canvas = document.getElementById('graph');
    const context = canvas.getContext('2d');
    
    // Clear canvas
    context.fillStyle = 'whitesmoke';
    context.lineWidth = 5;
    context.fillRect(0, 0, GRAPH_PERIOD, GRAPH_HEIGHT);
    const averagePrice = PRICE_HISTORY.reduce((a, b) => a+b)/PRICE_HISTORY.length;
    
    // Draw exponential lines and numbers
    for (let i = 0; i < 100; i++) {
      context.beginPath();
      context.moveTo(0, GRAPH_HEIGHT/2 + averagePrice-Math.pow(1.2, i));
      context.lineTo(GRAPH_PERIOD, GRAPH_HEIGHT/2 + averagePrice-Math.pow(1.2, i));
      context.strokeStyle = 'lightgray';
      context.strokeWidth = 5;
      context.stroke();
      context.font = `${0.1*Math.pow(1.2, i)}px Arial`;
      context.fillStyle = 'lightgray';
      context.fillText(String(Math.pow(1.2, i).toFixed(2)), 10, GRAPH_HEIGHT/2 + averagePrice-Math.pow(1.2, i)-10);
    }
    
    // Draw orders
    for (order of ORDERS) {
      context.beginPath();
      context.moveTo(0, GRAPH_HEIGHT/2 + averagePrice-order.limitPrice);
      context.lineTo(GRAPH_PERIOD, GRAPH_HEIGHT/2 + averagePrice-order.limitPrice);
      context.strokeStyle = order.orderType === 'buy' ? 'green' : 'orangered';
      context.lineWidth = 5;
      context.stroke();
    }
    
    // Draw graph
    for (let i = 0; i < PRICE_HISTORY.length-1; i++) {
      context.beginPath();
      context.moveTo(i*GRAPH_PERIOD/PRICE_HISTORY.length, GRAPH_HEIGHT / 2 + averagePrice-PRICE_HISTORY[i]);
      context.lineTo((i+1)*GRAPH_PERIOD/PRICE_HISTORY.length, GRAPH_HEIGHT / 2 + averagePrice-PRICE_HISTORY[i+1]);
      context.strokeStyle = 'red';
      context.lineWidth = 5;
      context.stroke();
    }
  }
  
  const iterate = () => {;
    const difference = (Math.floor(Math.random()*2) == 1 ? 1 : -1)*CURRENT_STOCK_PRICE*0.01;
    
    // Calculate and set current price
    CURRENT_STOCK_PRICE = (Math.floor(Math.random()*2) == 1
      ? CURRENT_STOCK_PRICE * 1.01
      : CURRENT_STOCK_PRICE / 1.01)
    document.getElementById('currentStockPrice').innerHTML = CURRENT_STOCK_PRICE.toFixed(2);
    
    addToPriceHistory();

    handleOrders();
    
    // Set current money balance
    document.getElementById('currentMoneyBalance').innerHTML = CURRENT_MONEY_BALANCE.toFixed(2);

    // Set current stock count
    document.getElementById('currentStockCount').innerHTML = CURRENT_STOCK_COUNT.toFixed(2);
    
    // Calculate and set total value
    document.getElementById('currentPortfolioValue').innerHTML = (CURRENT_STOCK_PRICE*CURRENT_STOCK_COUNT).toFixed(2);
    document.getElementById('currentTotalValue').innerHTML = (CURRENT_STOCK_PRICE*CURRENT_STOCK_COUNT + CURRENT_MONEY_BALANCE).toFixed(2);
    
    // Calculate current time
    CURRENT_TIME++;
    
    drawGraph();
    setTimeout(iterate, 100);
  }

  initCanvas();
  iterate();
</script>